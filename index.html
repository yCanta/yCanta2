<!DOCTYPE html5>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <script src="jquery-3.4.0.min.js"></script>
    <script src="pouchdb.min.js"></script>
    <script src="db.js" type="text/javascript"></script>
    <script src="lib.js" type="text/javascript"></script>
    <script src="jquery.myTransposer.js" type="text/javascript"></script>
    <script src="jquery.toTextarea.js"></script>
    <script src="list.min.js"></script>

    <link rel="stylesheet" type="text/css" href="style.css">
    <link rel="stylesheet" type="text/css" href="2html.css">
    <title>yCanta2: TodosCantas > All Creatures of Our God and King</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
  </head>
  <body class="songbookList">
    <header>
      <h2><a href="#">yCanta</a></h2>
      <div class="navigation">
      </div>
    </header>
    <main>
      <div class="column active" id="songbookList">
        <div class="float-menu">
          <span class="float-menu-item"><span class="float-menu-icon">+</span> Add SB</span>
          <span class="float-menu-item  float-menu-toggle"><button type="button" class="float-menu-icon">+</button></span>
        </div>
        <div class="row">
          <div class="subcolumn">
            <div style="width: 300px;" >
              <a class="title_link" href="#"><h3>Songbooks &#x1F50D;</h3></a>
              <ul>
                <a href="#sb-aSongbook.xml"><li class="selected">todosCantas</li></a>
                <li>Black Book<a href="#" class="icon-fl-right">★</a></li>
                <li>  4/21/19 - Easter<a href="#" class="icon-fl-right">★</a>  </li>
                <hr>
    <li>  ABIDE Songbook  </li>
    <li>  Africa Worship  </li>
    <li>  America Worship </li>
    <li>  Arkansas River Trip </li>
    <li>  Baby Dedication 12/15/17  </li>
    <li>  Black Book  </li>
    <li>  CA Song Book Wk 1 </li>
    <li>  CA Song Book Wk 2 </li>
    <li>  Campfire  </li>
    <li>  Canaan Nominations  </li>
    <li>  Canaan Worship: Noah  </li>
    <li>  Carl's  </li>
    <li>  Chandigarh Worship  </li>
    <li>  Children's Songs Pamphlet </li>
    <li>  Christmas11 </li>
    <li>  Clermont Park Worship </li>
    <li>  Coxsackie Chapel 20180729 </li>
    <li>  Coxsackie Christmas Festival  </li>
    <li>  Coxsackie Kairos #23  </li>
    <li>  Coxsackie Kairos #29  </li>
    <li>  Coxsackie28Spanish  </li>
    <li>  Coxsackie_mass  </li>
    <li>  David's Worship Songbook  </li>
    <li>  DC Community Group  </li>
    <li>  DC Worship  </li>
    <li>  DC Worship 2  </li>
    <li>  Debrief </li>
    <li>  Espanol Canciones </li>
    <li>  Fairborn songs  </li>
    <li>  Friday Night Worship SAFB </li>
    <li>  graveside </li>
    <li>  Greene Kairos #3  </li>
    <li>  Greene Kairos #4  </li>
    <li>  Greene2Day2014  </li>
    <li>  GreeneSatJuly26 </li>
    <li>  Guys Night Mini </li>
    <li>  Hempel/Anderson Wedding </li>
    <li>  HempelHepworthWedding </li>
    <li>  HempelHorstWedding  </li>
    <li>  HempelLoseeWedding  </li>
    <li>  HerricksChoices </li>
    <li>  Himalaya Worship  </li>
    <li>  Home Group 12/3 </li>
    <li>  Ida Hempel funeral  </li>
    <li>  India Worship </li>
    <li>  JoannaCaseyWedding  </li>
    </ul>
            </div>
          </div>
        </div>
      </div>
      <div class="column" id="songList">
        <div class="float-menu">
          <a href="#sb-aSongbook.xml&s-aSong.song&edit" class="float-menu-item"><span class="float-menu-icon">+</span> Add Song</a>
          <span class="float-menu-item"><span class="float-menu-icon icon-rotate">&#9021;</span> Delete</span>
          <span class="float-menu-item"><span class="float-menu-icon">&#128424;</span> Export</span>
          <a href="#sb-aSongbook.xml&s-aSong.song&edit" class="float-menu-item"><span class="float-menu-icon">&#9998;</span> Edit</a>
          <span class="float-menu-item  float-menu-toggle"><button type="button" class="float-menu-icon">+</button></span>
        </div>
        <div class="row">
          <div class="subcolumn">
            <div style="width:400px;" id="songbook_content">
              <a class="title_link" href="#"><h3 id="songbook_title"></h3></a>
              <input class="search" type="text" data-target="#songbook_content" data-trigger="change" placeholder="Search">
              <ul class="list"></ul>
            </div>
            <span style="display:none">
              <li id="song-item-template" 
                  data-song-id=""
                  data-song-title=""
                  data-song-authors=""
                  data-song-scripture=""
                  data-song-introduction=""
                  data-song-key=""
                  data-song-categories=""
                  data-song-cclis=""
                  data-song-content=""
                  data-song-copyright="">
                <a href="" class="link name" ></a>
              </li>
            </span>
          </div>
          <div class="subcolumn" id="edit">
            <div>
              <h3>Add a song?<a href="#sb-aSongbook.xml" class="icon-fl-right close-icon">x</a></h3>
              <ul>
                <li>This little light of mine!</li>
                <li>All Hail the Power</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
      <div class="column" id="song">
        <div class="float-menu">
          <span class="float-menu-item"><span class="float-menu-icon icon-rotate">&#9021;</span> Delete</span>
          <button class="float-menu-item toggle-chords"><span class="float-menu-icon">&#9839;</span> Chords</button>
          <span class="float-menu-item"><span class="float-menu-icon">&#128424;</span> Export</span>
          <a href="#sb-aSongbook.xml&s-aSong.song&edit" class="float-menu-item"><span class="float-menu-icon">&#9998;</span> Edit</a>
          <span class="float-menu-item  float-menu-toggle"><button type="button" class="float-menu-icon">+</button></span>
        </div>
        <div class="row">
          <div class="subcolumn">
            <div class="content">
            </div>
          </div>
          <div class="subcolumn" id="edit">
            <div>
              <h3>Add a song Category?<a href="#sb-aSongbook.xml&s-aSong.song" class="icon-fl-right close-icon">x</a></h3>
              <ul>
                <li>God</li>
                <li>Holy Spirit</li>
                <li>Christ's Return</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </main>
    <footer>
      <span style="float: right;">rev __________ 1</span>    
      <div id="debugDiv">
      </div>
    </footer>
    <script>
      $('.column').click(function(){
        var h = $(this).height();
        var w = $(this).width();
        if((h <= 200 && h > 0) || ( w <= 200 && w > 0)) {
          location.hash = $(this).find('.title_link').attr('href');
        }
      });
      $(function () {
        editSong = function () {
          $('chunk').each(function(index){
            var content = [];
            $(this).children('line').each(function(index){
              if(is_chord_line($(this).html())){
                content.push(expand_chord($(this).html()));
              }
              else {
                content.push($(this).html());
              }
            });
            $(this).html(content.join('\n')).addClass('pre');
          });
          $('#song').first('.subcolumn').find('song').children().attr('contenteditable', 'true').toTextarea({
            allowHTML: false,//allow HTML formatting with CTRL+b, CTRL+i, etc.
            allowImg: false,//allow drag and drop images
            singleLine: false,//make a single line so it will only expand horizontally
            pastePlainText: true,//paste text without styling as source
            placeholder: true//a placeholder when no text is entered. This can also be set by a placeholder="..." or data-placeholder="..." attribute
          });
        }
        closeEdit = function () {
          $('#song').first('.subcolumn').find('song').children().attr('contenteditable', 'false');
          $('song chunk').each(function(index){
            var lines = $(this).html().split('\n');
            var prev_is_chord = false;
            var content = '';
            $(lines).each(function(index){
              if(prev_is_chord){
                content += '<line>'+combine(lines[index-1],this)+'</line>';
                prev_is_chord = false;
              }
              else if(isChord(this)){
                prev_is_chord = true;
              }
              else{  //we have a line
                content += '<line>'+this+'</line>';
              }
            })
            $(this).html(content);
          }).removeClass('pre');
          saveSong(parseHash('s-'));
        };

        // URL navigation implementing
        window.addEventListener("hashchange", hashchanged, false);

        // Trigger the event (useful on page load).
        hashchanged();


        //fun little function for counting syllables.  Need to create breaks in the line instead... if we were to use this for Chord positioning.
        var count = function(word) {
          word = word.toLowerCase(); 
          word = word.replace(/(?:[^laeiouy]|ed|[^laeiouy]e)$/, ''); 
          word = word.replace(/^y/, ''); 
          //return word.match(/[aeiouy]{1,2}/g).length; 
          var syl = word.match(/[aeiouy]{1,2}/g);
          console.log(syl);
          if(syl) {
            //console.log(syl);
            return syl.length;
          }
        }
      });   
      function hashchanged(){
        var hash = location.hash;
        //alert(hash);
        //if blank - should have to do nothing
        if(hash == ''){
         $('body').attr('class','songbookList');
         $('.active').removeClass('active');
         $('#songbookList').addClass('active')
        }
        //if song edit
        else if((hash.search('&s-') != -1) && (hash.search('&edit') != -1)) {
          //check if songbook is loaded
          //Initiate song edit
          $('body').attr('class', 'song edit');
          $('.active').removeClass('active');
          $('#song').addClass('active');
          editSong();
        }
        //if song
        else if(hash.search('&s-') != -1) {
          if($('body').hasClass('edit')){
            closeEdit();
          }
          //Need to check check if songbook is loaded
          loadSongbook();
          //Need to load song
          loadSong(parseHash('s-'));

          $('body').attr('class','song');
          $('.active').removeClass('active');
          $('#song').addClass('active');          
        }
        //if songbook edit
        else if((hash.search('#sb-') != -1) && (hash.search('&edit') != -1)) {
          //Initiate songbook edit
          $('body').attr('class', 'songList edit');
          $('.active').removeClass('active');
          $('#songList').addClass('active');
        }
        //if songbook
        else if(hash.search('#sb-') != -1) {
          loadSongbook();
          $('.active').removeClass('active');
          $('#songList').addClass('active');
        }
      }
    </script>
  </body>
</html>
