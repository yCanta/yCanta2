<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <meta name="Description" content="yCanta: Offline-first web application for creating and presenting songs and songbooks">
    <meta name="theme-color" content="lightblue">
    <meta name="msapplication-TileColor" content="#00aba9">

    <link rel="manifest" href="manifest.webmanifest">
    <link rel="icon" type="image/x-icon" href="favicon.png">
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
    <link rel="mask-icon" href="safari-pinned-tab.svg" color="#ff0000">

    <script src="jquery-3.4.0.min.js"></script>
    <script src="pouchdb.min.js"></script>
    <script src="db.js"></script>
    <script src="lib.js"></script>
    <script src="jquery.myTransposer.js"></script>
    <script src="jquery.toTextarea.js"></script>
    <script src="list.min.js"></script>
    <script src="sortable.js"></script>
    <script src="jszip.min.js"></script>
    <script src="song2json.js"></script>
    <script src="pdfformatter.js"></script>
    <script src="pdfkit.standalone.js"></script>
    <script src="blob-stream.js"></script>

    <link rel="stylesheet" type="text/css" href="style.css">
    <link rel="stylesheet" type="text/css" href="jquery.myTransposer.css">
    <link rel="stylesheet" type="text/css" href="2html.css">
    <title>yCanta2: TodosCantas > All Creatures of Our God and King</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
  </head>
  <body class="header">
    <header id="header">
      <h2><a href="#">yCanta</a></h2>
      <span style="position: absolute; top:0;right:0;">

      </span>
      <hr>
      <div class="scrollable">
        <a class="btn songbookList-color" href="#songbooks">Songbooks</a>
        <a class="btn songList-color" href="#sb-allSongs">All Songs</a>



        <h2>Brief Introduction</h2>

        You can view songbooks or songs by selecting one of the above buttons.<br><br>
        
        To import more songs, choose a zip file and upload it below.
      </div>

      <div>
        <h2>Utilities</h2>

        <label class="btn">Upload songs:<input type="file" id="file" name="file" />
        </label>
        <br>
        <br>

        <div id="result">
        </div>

        <a href="#" class="btn" style="background-color: crimson; color: white;" onclick="db.destroy().then(function () {
              window.location.reload();
            }).catch(function (err) {
              console.log(err);
          });">Reset DB</a>
      </div>

    </header>
    <main>
      <div class="column active" id="songbookList">
        <div class="float-menu">
          <div>
            <a data-songbook-edit="new" class="float-menu-item"><span class="float-menu-icon">+</span> Add SB</a>
            <span class="float-menu-item  float-menu-toggle"><button type="button" class="float-menu-icon">+</button></span>
          </div>
        </div>
        <div class="row">
          <div class="subcolumn">
            <div id="songbooks">
              <div id="songbooks_header">
                <a class="title_link" href="#songbooks"><h3>Songbooks</h3></a>
                <input aria-label="Search" class="search deletable" type="text" data-target="#songbooks" data-trigger="change" placeholder="Search">
              </div>
              <ul class="list"></ul>
            </div>
            <ul style="display:none">
              <li id="songbook-item-template" 
                  data-songbook-id=""
                  data-songbook-rev=""
                  data-songbook-title="">
                <a href="" tabindex="0" class="link name" ></a>
              </li>
            </ul>
          </div>
        </div>
      </div>
      <div class="column" id="songList">
        <div class="float-menu">
          <a data-song-edit="new" class="float-menu-item"><span class="float-menu-icon">+</span> Add Song</a>
          <button data-home onclick="deleteSongbook(window.songbook._id)" class="float-menu-item delete"><span class="float-menu-icon">&#128465;</span> Delete</button>
          <span class="float-menu-item"><span class="float-menu-icon">&#128253;</span> Present</span>
          <a data-songbook-export class="float-menu-item"><span class="float-menu-icon">&#128424;</span> Export</a>
          <a data-songbook-edit class="float-menu-item"><span class="float-menu-icon">&#9998;</span> Edit</a>
          <span class="float-menu-item  float-menu-toggle"><button type="button" class="float-menu-icon">+</button></span>
        </div>
        <div class="row">
          <div class="subcolumn">
            <div id="songbook_content">
              <div id="songbook_header">
                <a data-songbook class="title_link" href="#"><h3 id="songbook_title">All Songs</h3></a>
                <input aria-label="Search" class="search deletable" type="text" data-target="#songbook_content" data-trigger="change" placeholder="Search">
                <nav id="category_filter_container">
                  <button class="cat_filter_btn" onclick="$('#category_filter_container').toggleClass('open'); $('#songbook_header').toggleClass('mb23');">⑂</button>
                  <div id="category_filter">
                    <label>Category: 
                      <select onchange="$('#songbook_content .search').val($(this).val())[0].dispatchEvent(new KeyboardEvent('keyup'));">
                      </select>
                    </label>
                  </div>
                </nav>

              </div>
              <ul class="list"></ul>
            </div>
            <ul style="display:none">
              <li id="song-item-template" 
                  data-song-id=""
                  data-song-rev=""
                  data-song-title=""
                  data-song-authors=""
                  data-song-scripture_ref=""
                  data-song-introduction=""
                  data-song-key=""
                  data-song-categories=""
                  data-song-cclis=""
                  data-song-content=""
                  data-song-copyright="">
                  <a href="" class="link name" tabindex="0"></a>
              </li>
            </ul>
          </div>
          <div class="subcolumn sidebar" id="songListEdit">
            <div id="songbook_edit_togglesongs" style="width: 240px">
              <div class="sticky">
                <h3>Add a song?<button onclick="$(this).closest('.sidebar-open').removeClass('sidebar-open');" class="icon-fl-right close-icon">&times;</button></h3>
                <input aria-label="Search" class="search deletable" type="text" data-target="#songbook_edit_togglesongs" data-trigger="change" placeholder="Search">
              </div>
              <ul class="list">
              </ul>
              <ul style="display:none">
                <li id="song-item-template-edit" 
                  data-song-id=""
                  data-song-rev=""
                  data-song-title=""
                  data-song-authors=""
                  data-song-scripture=""
                  data-song-introduction=""
                  data-song-key=""
                  data-song-categories=""
                  data-song-cclis=""
                  data-song-content=""
                  data-song-copyright="">
                  <a href="" class="name"tabindex="0" ></a>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
      <div class="column nochords" id="song">
        <div class="float-menu">
          <button data-songbook onclick="deleteSong(window.song._id)" class="float-menu-item"><span class="float-menu-icon">&#128465;</span> Delete</button>
          <a data-song-export class="float-menu-item"><span class="float-menu-icon">&#128424;</span> Export</a>
          <span class="float-menu-item"><span class="float-menu-icon">&#128253;</span> Present</span>
          <a data-song-edit class="float-menu-item"><span class="float-menu-icon">&#9998;</span> Edit</a>
          <span class="float-menu-item  float-menu-toggle"><button type="button" class="float-menu-icon">+</button></span>
        </div>
        <div class="row">
          <div class="subcolumn">
            <div>
              <article class="content">
              </article>
            </div>
          </div>
          <div class="subcolumn sidebar" id="song-edit">
            <div id="categories" style="width: 240px;">
              <div class="sticky">
                <h3>Song Categories<button onclick="$(this).closest('#song-edit').removeClass('sidebar-open');" class="icon-fl-right close-icon">&times;</button></h3>
                <input aria-label="Search" class="search deletable" type="text" data-target="#categories" data-trigger="change" placeholder="Search">
              </div>
              <ul class="list">
              </ul>
              <ul style="display:none">
                <li id="category-template">
                  <label>
                    <input type="checkbox">
                    <span class="name"></span>
                  </label>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
      <div class="column" id="export">
        <div class="float-menu">
          <button class="float-menu-item" onclick="window.location.hash=window.location.hash.replace('&export','');"><span class="float-menu-icon">&#128465;</span> Cancel</button>
          <button data-song class="float-menu-item"><span class="float-menu-icon">&#128190;</span> Save</button>
          <span class="float-menu-item"><span class="float-menu-icon">&#128424;</span> Export</span>
          <span class="float-menu-item  float-menu-toggle"><button type="button" class="float-menu-icon">+</button></span>
        </div>
        <div class="row">
          <div class="subcolumn">
            <div class="content">
              <h3 class="export_header">Export</h3>
              <table>
                <td>
                  <button style="background-color: lightgray" class="btn" onclick="makePDF(window.exportObject, document.querySelector('iframe'))">Generate</button>
                </td>
                <td style="width: 100%">
                  <div id='pdf_progress_bar' style='border: 1px solid black; position: relative;'>
                    <div style='border-right: 1px solid gray; background-color: white; width:0%; height:1.2em;text-align: center;' id='pdf_progress'>
                    </div>
                    <span id='pdf_progress_text' style='font-size:small; white-space:nowrap; position: absolute; top:0; right: 0; left: 0; bottom: 0; text-align: center;'></span>
                  </div>
                </td>
              </table>
              <br>
              <form id="export_form">
                <input id="collapsible1" class="toggle" type="radio" name="accordion">
                <label for="collapsible1" class="lbl-toggle">Text Options
                  <span style="display: inline-block;">
                    <span>
                      <div id="font_summary"></div>
                      <div id="text_summary"></div>
                    </span>
                    <span style="border-left: 1px solid white; padding-left: 0.5em;">
                      <div id="song_title_summary"></div>
                      <div id="ccli_summary"></div>
                    </span>
                    <span style="border-left: 1px solid white; padding-left: 0.5em;">
                      <div id="print_summary"></div>
                      <div id="chords_summary"></div>
                    </span>
                  </span>
                </label>
                <div class="collapsible-content">
                  <div class="content-inner">
                    <div class="t3 hide_for_songs" title="Choose the songs you want to print based on status">
                      <label>Print</label>
                      <span>
                        <label for="print_a">👍</label>
                        <input type="checkbox" id="print_a" name="print_a">
                        <label for="print_n">⏱️</label>
                        <input type="checkbox" id="print_n" name="print_n">
                        <label for="print_r">👎</label>
                        <input type="checkbox" id="print_r" name="print_r">
                      </span>
                    </div>
                    <div class="t3" title="Font to be used in the songbook">
                      <label for="font_face">Default Font</label>
                      <select size="1" id="font_face" name="font_face" style="display: inline-block;">
                        <option value="Courier">Courier</option><option value="Courier-Bold">Courier-Bold</option><option value="Courier-BoldOblique">Courier-BoldOblique</option><option value="Courier-Oblique">Courier-Oblique</option><option value="Helvetica" selected>Helvetica</option><option value="Helvetica-Bold">Helvetica-Bold</option><option value="Helvetica-BoldOblique">Helvetica-BoldOblique</option><option value="Helvetica-Oblique">Helvetica-Oblique</option><option value="Symbol">Symbol</option><option value="Times-Bold">Times-Bold</option><option value="Times-BoldItalic">Times-BoldItalic</option><option value="Times-Italic">Times-Italic</option><option value="Times-Roman">Times-Roman</option><option value="ZapfDingbats">ZapfDingbats</option>
                      </select>
                    </div>
                    <div class="t3">
                      <label for="display_chords">Display Chords?</label>
                      <select size="1" id="display_chords" name="display_chords">
                        <option value="no">no</option>
                        <option value="yes">yes</option>
                        <option value="yes">1st</option>
                      </select>
                    </div>
                    <div class="t3 hide_for_songs">
                      <label for="start_song_on_new_page">Start songs on new pages:</label>
                      <input type="checkbox" id="start_song_on_new_page" name="start_song_on_new_page">
                    </div>
                    <div class="t3 hide_for_songs">
                      <label for="hide_booktitle">Hide book title?</label>
                      <select size="1" id="hide_booktitle" name="hide_booktitle">
                        <option value="no">no</option><option value="yes">yes</option>
                      </select>
                    </div>
                    <div class="t3">
                      <label for="songtitle_format" title="${num} substitutes the song number">Song title # format:</label>
                      <input size="10" type="text" id="songtitle_format" value="${num} " name="songtitle_format">
                    </div>
                    <div class="t3">
                      <label for="scripture_location">Scripture reference:</label>
                      <select size="1" id="scripture_location" name="scripture_location" style="display: inline-block;">
                        <option value="in-title">in-title</option>
                        <option value="under-title">under-title</option>
                      </select>
                    </div>
                    <div class="t3">
                      <label for="ccli">CCLI license#: </label>
                      <input size="7" type="text" id="ccli" name="ccli">
                    </div>
                        
                    <h4>Text Details<select id="text" class="fr">
                      <option value='default'>Default</option>
                      <option value='small'>Small</option>
                      <option value='large'>Large</option>
                      <option value='custom'>Custom</option>
                    </select></h4>
                    <table id="text_table" class="table">
                      <tr>
                        <th></th>
                        <th><small>Size</small></th>
                        <th title="Space below the text"><small>Space</small></th>
                        <th title="Allow automatic reduction of font size to this percentage of the set font size"><small>Resize</small></th>
                      </tr>
                      <tr class="hide_for_songs">
                        <td>Book Title</td>
                        <td><input type="number" id="booktitle_size" name="booktitle_size" value="24"></td>
                        <td><input type="number" id="booktitle_space" name="booktitle_space" value="12"></td>
                        <td></td>
                      </tr>
                      <tr>
                        <td>Song Title</td>
                        <td><input type="number" id="songtitle_size" name="songtitle_size" value="14"></td>
                        <td><input type="number" id="songtitle_space" name="songtitle_space" value="6"></td>
                        <td></td>
                      </tr>
                      <tr>
                        <td><small>Small Text</small></td>
                        <td><input type="number" id="small_size" name="small_size" value="8"></td>
                        <td><input type="number" id="small_space" name="small_space" value="8"></td>
                        <td></td>
                      </tr>
                      <tr>
                        <td>Line</td>
                        <td><input type="number" id="songline_size" name="songline_size" value="12"></td>
                        <td><input type="number" id="songline_space" name="songline_space" value="4"></td>
                        <td title="Allow automatic reduction of font size to this percentage of the set font size">
                          <select size="1" id="resize_percent" name="resize_percent">
                            <option value="100">100%</option><option value="95">95%</option><option value="90">90%</option><option value="85">85%</option><option value="80">80%</option><option value="75">75%</option><option value="70">70%</option><option value="65">65%</option><option value="60">60%</option><option value="55">55%</option><option value="50">50%</option>
                            <option value="0">Wrap</option>
                          </select>
                        </td>
                      </tr>
                      <tr>
                        <td>Chord</td>
                        <td><input type="number" id="songchord_size" name="songchord_size" value="12"></td>
                        <td><input type="number" id="songchord_space" name="songchord_space" value="1"></td>
                        <td></td>
                      </tr>
                      <tr>
                        <td colspan=2 title="Spacing before Chorus/Verse/Bridge/etc">Block Spacing</td>
                        <td><input type="number" id="songchunk_b4" name="songchunk_b4" value="12"></td>
                        <td></td>
                      </tr>
                      <tr>
                        <td colspan=2 title="Spacing after the end of the song">Song Spacing</td>
                        <td><input type="number" id="song_space_after" name="song_space_after" value="12"></td>
                        <td></td>
                      </tr>
                      <tr>
                        <td>Copyright</td>
                        <td><input type="number" id="copyright_size" name="copyright_size" value="8"></td>
                        <td><input type="number" id="copyright_space_b4" name="copyright_space_b4" value="3"></td>
                        <td></td>
                      </tr>
                    </table>
                  </div>
                </div>

                <input id="collapsible2" class="toggle" type="radio" name="accordion">
                <label for="collapsible2" class="lbl-toggle">Page Options
                  <span style="display: inline-block;">
                    <span id="page_icon"></span>
                    <span>
                      <div id="page_size_summary"></div>
                      <div id="margin_gutter"></div>
                    </span>
                    <span id="margin_icon" class="normal">
                      <span class="flex">
                        <span class="col"></span>
                        <span class="col"></span>
                        <span class="col"></span>
                      </span>
                      <span class="flex">
                        <span class="col"></span>
                        <span class="col"></span>
                        <span class="col"></span>
                      </span>
                      <span class="flex">
                        <span class="col"></span>
                        <span class="col"></span>
                        <span class="col"></span>
                      </span>                                        
                    </span>
                    <span>
                      <div id="margin_summary">Normal</div>
                      <div id="margin_summary_nums">1"</div>
                    </span>
                  </span>
                </label>
                <div class="collapsible-content">
                  <div class="content-inner">
                    <div class="t3" title="Number of columns">
                      <label for="columns">Columns</label>
                      <span>
                        <input type="number" id="columns" name="columns" value="1">
                      </span>
                    </div>
                    <div class="t3" title="Choose the physical layout of the songbook">
                      <label for="page_layout">Layout</label>
                      <select size="1" id="page_layout" name="page_layout">
                        <option value="single-sided">single-sided</option><option value="booklet">booklet</option><option value="double-sided">double-sided</option><option value="adobe-booklet">adobe-booklet</option>
                      </select>
                    </div>
                    <div class="t3">
                      <label for="paper_orientation">Orientation</label>
                      <select size="1" id="paper_orientation" name="paper_orientation">
                        <option value="portrait">portrait</option><option value="landscape">landscape</option>
                      </select>
                    </div>
                    <div class="t3">
                      <label for="paper_size">Paper Size</label>
                      <select size="1" id="paper_size" name="paper_size" style="display: inline-block;">
                        <option value="A0">A0</option><option value="A1">A1</option><option value="A2">A2</option><option value="A3">A3</option><option value="A4">A4</option><option value="A5">A5</option><option value="A6">A6</option><option value="B0">B0</option><option value="B1">B1</option><option value="B2">B2</option><option value="B3">B3</option><option value="B4">B4</option><option value="B5">B5</option><option value="B6">B6</option><option value="TABLOID">11x17</option><option value="LEGAL">LEGAL</option><option value="LETTER" selected>LETTER</option>
                      </select>
                    </div>
                    <h4>Margins<select id="margin" class="fr">
                      <option value='normal'>Normal</option>
                      <option value='narrow'>Narrow</option>
                      <option value='wide'>Wide</option>
                      <option value='custom'>Custom</option>
                    </select></h4>
                    <table id="margin_table" class="table">
                      <thead>
                        <tr>
                          <th>
                          </th>
                          <th>
                            <small>Size</small>
                          </th>
                          <th>
                          </th>
                          <th>
                            <small>Size</small>
                          </th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td>
                            Top
                          </td>
                          <td>
                            <input type="number" id="paper_margin_top" name="paper_margin_top" value="1" step="0.1" min="0">
                          </td>
                          <td>
                            Bottom
                          </td>
                          <td>
                            <input type="number" id="paper_margin_bottom" name="paper_margin_bottom" value="1" step="0.1" min="0">
                          </td>
                        </tr>
                        <tr>
                          <td>
                            <span data-booklet="Inside">Left</span>
                          </td>
                          <td>
                            <input type="number" id="paper_margin_left" name="paper_margin_left" value="1" step="0.1" min="0">
                          </td>
                          <td>
                            <span data-booklet="Outside">Right</span>
                          </td>
                          <td>
                            <input type="number" id="paper_margin_right" name="paper_margin_right" value="1" step="0.1" min="0">
                          </td>
                        </tr>
                        <tr>
                          <td>
                            Gutter
                          </td>
                          <td>
                            <input type="number" id="paper_margin_gutter" name="paper_margin_gutter" value="0" step="0.1" min="0">
                          </td>
                          <td>
                            Column Gutter
                          </td>
                          <td>
                            <input type="number" id="column_gutter" name="column_gutter" value="1" step="0.1" min="0">
                            <select size="1" id="gutter_side" name="gutter_side">
                              <option value="left">Left</option>
                              <option value="top">Top</option>
                              <option value="inside">Inside</option>
                            </select>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>

                <input id="collapsible3" class="toggle hide_for_songs" type="radio" name="accordion">
                <label for="collapsible3" class="lbl-toggle hide_for_songs">Index Options
                  <span style="display: inline-block;">
                    <span>
                      <div id="alphabetical_summary"></div>
                      <div id="category_summary"></div>
                    </span>
                    <span style="border-left: 1px solid white; padding-left: 0.5em;">
                      <div id="scripture_summary"></div>
                      <div id="index_summary"></div>
                    </span>
                  </span>
                </label>
                <div class="collapsible-content hide_for_songs">
                  <div class="content-inner">
                    <h4>Print Indexes:</h4>
                    <div class="t3">
                      <label for="display_index">Index</label>
                      <select size="1" id="display_index" name="display_index">
                        <option value="on-new-page">On, new page</option>
                        <option value="no-page-break">On, inline</option>
                        <option value="no-index">Off</option>
                      </select>
                      <span style="text-align: right; width: 100%;">
                        <label for="include_first_line">Include 1st verse and chorus?</label>
                        <input type="checkbox" id="include_first_line" name="include_first_line">
                      </span>
                    </div>
                    <div class="t3">
                      <label for="display_cat_index">Categories</label>
                      <select size="1" id="display_cat_index" name="display_cat_index">
                        <option value="on-new-page">On, new page</option>
                        <option value="no-page-break">On, inline</option>
                        <option value="no-index">Off</option>
                      </select>
                    </div>
                    <div class="t3">
                      <label for="display_scrip_index">Scripture</label>
                      <select size="1" id="display_scrip_index" name="display_scrip_index">
                        <option value="on-new-page">On, new page</option>
                        <option value="no-page-break">On, inline</option>
                        <option value="no-index">Off</option>
                      </select>
                    </div>
                    <h4>Index Details<select id="index" class="fr">
                      <option value='default'>Default</option>
                      <option value='small'>Small</option>
                      <option value='large'>Large</option>
                      <option value='custom'>Custom</option>
                    </select></h4>
                    <table id="" class="table">
                      <tr>
                        <th><small>Titles</small></th>
                        <th><small>Size</small></th>
                        <th title="Spacing below the text"><small>Space</small></th>
                        <th><small>Font</small></th>
                      </tr>
                      <tr>
                        <td>Index</td>
                        <td><input type="number" id="index_title_size" name="index_title_size" value="18"></td>
                        <td><input type="number" id="index_title_space" name="index_title_space" value="6"></td>
                        <td>
                          <select size="1" id="index_title_font" name="index_title_font">
                            <option value="Courier">Courier</option><option value="Courier-Bold">Courier-Bold</option><option value="Courier-BoldOblique">Courier-BoldOblique</option><option value="Courier-Oblique">Courier-Oblique</option><option value="Helvetica">Helvetica</option><option value="Helvetica-Bold">Helvetica-Bold</option><option value="Helvetica-BoldOblique">Helvetica-BoldOblique</option><option value="Helvetica-Oblique">Helvetica-Oblique</option><option value="Symbol">Symbol</option><option value="Times-Bold">Times-Bold</option><option value="Times-BoldItalic">Times-BoldItalic</option><option value="Times-Italic">Times-Italic</option><option value="Times-Roman">Times-Roman</option><option value="ZapfDingbats">ZapfDingbats</option>
                          </select>
                        </td>
                      </tr>
                      <tr>
                        <td title="Spacing between songs and the Index if index on same page as songs" colspan=2 class="art"><small>Space Before</small></td>
                        <td><input type="number" id="index_title_b4" name="index_title_b4" value="20"></td>
                        <td></td>
                      </tr>
                      <tr>
                        <td>Category</td>
                        <td><input type="number" id="index_cat_size" name="index_cat_size" value="14"></td>
                        <td><input type="number" id="index_cat_space" name="index_cat_space" value="6"></td>
                        <td>
                          <select size="1" id="index_cat_font" name="index_cat_font">
                            <option value="Courier">Courier</option><option value="Courier-Bold">Courier-Bold</option><option value="Courier-BoldOblique">Courier-BoldOblique</option><option value="Courier-Oblique">Courier-Oblique</option><option value="Helvetica">Helvetica</option><option value="Helvetica-Bold">Helvetica-Bold</option><option value="Helvetica-BoldOblique">Helvetica-BoldOblique</option><option value="Helvetica-Oblique">Helvetica-Oblique</option><option value="Symbol">Symbol</option><option value="Times-Bold">Times-Bold</option><option value="Times-BoldItalic">Times-BoldItalic</option><option value="Times-Italic">Times-Italic</option><option value="Times-Roman">Times-Roman</option><option value="ZapfDingbats">ZapfDingbats</option>
                          </select>
                        </td>
                      </tr>
                      <tr>
                        <td title="Spacing before catedories in the category index" colspan=2 class="art"><small>Space Before</small></td>
                        <td><input type="number" id="index_cat_b4" name="index_cat_b4" value="12"></td>
                        <td></td>
                      </tr>
                      <tr>
                        <th colspan=4>
                          <small>Index Song Lines</small>
                        </th>
                      </tr>
                      <tr>
                        <td>Song Title</td>
                        <td><input type="number" id="index_song_size" name="index_song_size" value="12"></td>
                        <td><input type="number" id="index_song_space" name="index_song_space" value="4"></td>
                        <td>
                          <select size="1" id="index_song_font" name="index_song_font">
                            <option value="Courier">Courier</option><option value="Courier-Bold">Courier-Bold</option><option value="Courier-BoldOblique">Courier-BoldOblique</option><option value="Courier-Oblique">Courier-Oblique</option><option value="Helvetica">Helvetica</option><option value="Helvetica-Bold">Helvetica-Bold</option><option value="Helvetica-BoldOblique">Helvetica-BoldOblique</option><option value="Helvetica-Oblique">Helvetica-Oblique</option><option value="Symbol">Symbol</option><option value="Times-Bold">Times-Bold</option><option value="Times-BoldItalic">Times-BoldItalic</option><option value="Times-Italic">Times-Italic</option><option value="Times-Roman">Times-Roman</option><option value="ZapfDingbats">ZapfDingbats</option>
                          </select>
                        </td>
                      </tr>
                      <tr>
                        <td>First Line</td>
                        <td><input type="number" id="index_first_line_size" name="index_first_line_size" value="11"></td>
                        <td><input type="number" id="index_first_line_space" name="index_first_line_space" value="4"></td>
                        <td>
                          <select size="1" id="index_first_line_font" name="index_first_line_font">
                            <option value="Courier">Courier</option><option value="Courier-Bold">Courier-Bold</option><option value="Courier-BoldOblique">Courier-BoldOblique</option><option value="Courier-Oblique">Courier-Oblique</option><option value="Helvetica">Helvetica</option><option value="Helvetica-Bold">Helvetica-Bold</option><option value="Helvetica-BoldOblique">Helvetica-BoldOblique</option><option value="Helvetica-Oblique">Helvetica-Oblique</option><option value="Symbol">Symbol</option><option value="Times-Bold">Times-Bold</option><option value="Times-BoldItalic">Times-BoldItalic</option><option value="Times-Italic">Times-Italic</option><option value="Times-Roman">Times-Roman</option><option value="ZapfDingbats">ZapfDingbats</option>
                          </select>
                        </td>
                      </tr>
                      <tr>
                        <td title="Categories to exclude (separate with a ',' no spaces allowed)">Excluded categories</td>
                        <td colspan="3"><input size="30" type="text" id="index_cat_exclude" name="index_cat_exclude"></td>
                      </tr>
                    </table>
                  </div>
                </div>

                <input id="collapsible4" class="toggle" type="radio" name="accordion">
                <label for="collapsible4" class="lbl-toggle">More Info</label>
                <div class="collapsible-content">
                  <div class="content-inner">
                    <span>
                      Settings:!
                    </span>
                  </div>
                </div>
              </form>
            </div>
          </div>
          <div class="subcolumn sidebar" id="exportPreview">
            <div style="width: 240px;">
              <div class="sticky">
                <h3>Preview<button onclick="$(this).closest('#exportPreview').removeClass('sidebar-open');" class="icon-fl-right close-icon">&times;</button></h3><input id="auto_refresh" name="auto_refresh" type="checkbox"><label for="auto_refresh">Automatic refresh?</label>
                  <!-- can't seem to get chrome to display this in iframe, objects or any other thingy without crashing on src change.  I get an "awSnap!" message and closed out tab -->
                <iframe title="Generated PDF" width="320" height="450" src=""></iframe>
                <br>
                <br>
                <button class="btn" style="background-color: lightsalmon;">Download</button>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="column" id="column-filler">
        <div class="float-menu">
        </div>
      </div>
      
    </main>
    <footer>
      <span style="float: right;">rev __________ 1</span>    
      <div id="debugDiv">
      </div>
    </footer>
    <script>
      $('#song .row').append('<button onclick="toggleFullscreen(this)" class="icon-rotate2x tr">&#8596;</button>');

      bindToSongEdit();
      initializeSongbooksList();
      $("#export_form > label").click(function(e){
        if(this.previousElementSibling.checked){
          e.stopPropagation();
          e.preventDefault();
          this.previousElementSibling.checked = false;
        };
      });
      $('.column').click(function(e){
        var h = this.offsetHeight;
        var w = this.offsetWidth;
        if((h <= 100 && h > 0) || ( w <= 60 && w > 0)) {
          e.preventDefault();
          e.stopPropagation();
          if (confirmWhenEditing()) { return };
          location.hash = $(this).find('.title_link').attr('href');
        }
      });
      $('.content-inner').change(function(){
        export_form_summary_update();
      });
      $('#margin').change(function() {
        if(this.value != 'custom'){
          let margins = window.export.margins[this.value];
          document.getElementById('paper_margin_top').value = margins[0];
          document.getElementById('paper_margin_right').value = margins[1];
          document.getElementById('paper_margin_bottom').value = margins[2];
          document.getElementById('paper_margin_left').value = margins[3];
          document.getElementById('column_gutter').value = margins[4];
        }
      });
      $('#text').change(function() {
        if(this.value != 'custom'){
          let text = window.export.text[this.value];
          set_value_by_id(text);
        }
      });
      $('#index').change(function() {
        if(this.value != 'custom'){
          let index = window.export.index[this.value];
          set_value_by_id(index);
        }
      });
      $(function () {
        $('input.deletable').wrap('<span class="deleteicon" />').after($('<span/>').click(function() {
          $(this).prev('input').val('').trigger('change').focus()[0].dispatchEvent(new KeyboardEvent("keyup"));
        }));
        // URL navigation implementing
        window.addEventListener("hashchange", hashchanged, false);
        // Trigger the event (useful on page load).
        hashchanged();
        // keep page from reloading if editing
        window.onbeforeunload = function() {
          return window.editing ? "If you leave this page you will lose your unsaved changes." : null;
        }
        // keep hash from changing if editing
        $('body').on('click', 'a[href]', function(e) {
          e.preventDefault();
          var $item = $(e.currentTarget), hashValue = $item.attr('href').slice(1);
          // Check to see if we're editing
          if (confirmWhenEditing()) { return };
          
          //remove edit buttons
          $('.edit_buttons').remove();

          //set the hash if necessary still
          window.location.hash = hashValue;
          return false;
        });
      });   
      function hashchanged(){
        var hash = location.hash;
        if(window.old_hash == hash){
          return
        }

        if(confirmWhenEditing()) {
          window.location.hash = window.old_hash;
          return
        }

        /*/doesn't yet prevent - but does let you know need to restore the hash.
        if(window.editing){
          confirmWhenEditing();
        }*/
        //if blank - should have to do nothing
        if(hash == ''){
         $('body').attr('class','header');
         $('.active').removeClass('active');
         updateAllLinks();
         window.document.title = "yCanta2";
        }
        else if(hash == '#songbooks'){
         $('body').attr('class','songbookList');
         $('.active').removeClass('active');
         $('#songbookList').addClass('active');
         updateAllLinks();
         window.document.title = "yCanta2";
        }
        //if song edit
        else if((hash.search('&s-') != -1) && (hash.search('&edit') != -1)) {
          //check if songbook is loaded
          Promise.all([loadSongbook(parseHash('sb-')), loadSong(parseHash('s-'))])
            .then(function(values){
              //Initiate song edit
              $('body').attr('class', 'song edit');
              $('.active').removeClass('active');
              $('#song').addClass('active');
              editSong();
              updateAllLinks();
              window.document.title = "yCanta2: Editing " + window.song.title;
          });
        }
        //if song export
        else if((hash.search('&s-') != -1) && (hash.search('&export') != -1)) {
          //Initiate song export
          Promise.all([loadSongbook(parseHash('sb-')), loadSong(parseHash('s-'))])
            .then(function(){
            //get the song object db.get(id) and save it to window.exportObject
              return window.exportObject = window.song;
            }).then(function(values){
              prepExport();
              console.log(window.exportObject);
              //makePDF(window.exportObject, document.querySelector('embed'));

              //Initiate song export
              $('body').attr('class', 'song export');
              $('.active').removeClass('active');
              $('#export').addClass('active');
              updateAllLinks();
              window.document.title = "yCanta2: Exporting " + window.song.title;
          });
        }
        //if song
        else if(hash.search('&s-') != -1) {
          if(hash.search('s-new-song') != -1){
            window.location.hash = '#' + window.songbook._id;
            return
          }
          Promise.all([loadSongbook(parseHash('sb-')), loadSong(parseHash('s-'))])
            .then(function(values) {
              $('body').attr('class','song');
              $('.active').removeClass('active');
              $('#song').addClass('active');
              updateAllLinks();
              window.document.title = "yCanta2: "+window.songbook.title + " > " + window.song.title;
          });          
        }
        //if songbook edit
        else if((hash.search('#sb-') != -1) && (hash.search('&edit') != -1)) {
          //Initiate songbook edit
          Promise.resolve(loadSongbook(parseHash('sb-')))
            .then(function() {
              $('body').attr('class', 'songList edit');
              $('.active').removeClass('active');
              $('#songList').addClass('active');
              editSongbook();
              updateAllLinks();
              window.document.title = "yCanta2: Editing " + window.songbook.title;
          });
        }
        //if songbook export
        else if((hash.search('#sb-') != -1) && (hash.search('&export') != -1)) {
          //Initiate songbook export
          Promise.resolve(loadSongbook(parseHash('sb-')))
            .then(function(){
              //get the songbook object and all songs and save them to window.exportObject
              return new Promise(function(resolve, reject){
                //Songbooks are already loaded into the window.songbook object
                window.exportObject = window.songbook;
                var sb_song_ids = window.songbook.songrefs.map(function (row) {
                    return row.id
                  });
                db.allDocs({
                  include_docs: true,
                  keys: sb_song_ids, //we need error handling for missing ids
                }).then(function (result) {
                  window.exportObject.songs = result.rows;
                  console.log(window.exportObject);
                  prepExport();
                  resolve('Its done')
                }).catch(function (err) {
                  console.log(err);
                });
              });
            }).then(function(values){
              //makePDF(window.exportObject, document.querySelector('embed'));

              $('body').attr('class', 'songList export');
              $('.active').removeClass('active');
              $('#export').addClass('active');
              updateAllLinks();
              window.document.title = "yCanta2: Exporting " + window.songbook.title;
          });
        }
        //if songbook
        else if(hash.search('#sb-') != -1) {
          Promise.resolve(loadSongbook(parseHash('sb-')))
            .then(function() {
              $('body').attr('class', 'songList');
              $('.active').removeClass('active');
              $('#songList').addClass('active');
              updateAllLinks();
              window.document.title = "yCanta2: " + window.songbook.title;
          });
        }
        window.old_hash = window.location.hash;
      }
    </script>
  </body>
</html>
